---
# All variables needed to deploy the tripleo-quickstart-scalelab project.

rhos_release_rpm: "{{ lookup('env', 'RHOS_RELEASE_URL') }}"

# OSP/OSPd versioning and build
version: 11
rhel_version: 7.4
rhos_release: 11-director
build: z4

overcloud_image_password: debug

# Introspection parameters:
# No introspection at all - adjusts instackenv to not require introspection
instackenv_no_introspection: "{{ lookup('env', 'OSP_INSTACKENV_NO_INTROSPECTION')|default(false, true) }}"
node_provide_timeout: "{{ lookup('env', 'OSP_NODE_PROVIDE_TIMEOUT')|default(1800, true) }}"
# bulk introspection
introspection: "{{ lookup('env', 'OSP_BULK_INTROSPECTION')|default(false, true) }}"
# Introspection Script (Disable bulk if using)
introspect_with_retry: "{{ lookup('env', 'OSP_INTROSPECTION_SCRIPT')|default(true, true) }}"

# Ironic automated cleaning (Use when introspection script is disabled)
node_cleaning: "{{ lookup('env', 'OSP_NODE_CLEANING')|default(false, true) }}"

# Stack user password. Encrypted with sha512
stack_password: "{{ lookup('env', 'STACK_PASSWORD') }}"

####################################################################################################
# Network Setup
####################################################################################################
# Undercloud control plane interface:
local_interface: "{{ lookup('env', 'OSP_UNDERCLOUD_LOCAL_INTERFACE')|default('enp94s0f1', true) }}"

# External Network Setup:
# 0 - private external network (Unlimited private floating ips)
# 1 - public external network (Limited public floating ips)
external_network_setup: "{{ lookup('env', 'OSP_EXTERNAL_NETWORK_SETUP')|default(0, true) }}"

# Settings for both Network Setups
dns_server: "{{ lookup('env', 'OSP_DNS_SERVER') }}"
external_vlan: "{{ lookup('env', 'OSP_EXTERNAL_VLAN')|default('10', true) }}"
external_network_pool_start: "{{ lookup('env', 'OSP_EXTERNAL_NET_POOL_START')|default('172.21.0.100', true) }}"
external_network_pool_end: "{{ lookup('env', 'OSP_EXTERNAL_NET_POOL_END')|default('172.21.255.254', true) }}"
external_network_gateway: "{{ lookup('env', 'OSP_EXTERNAL_NET_GATEWAY')|default('172.21.0.1', true) }}"
external_network_cidr: "{{ lookup('env', 'OSP_EXTERNAL_NET_CIDR')|default('172.21.0.0/16', true) }}"
external_network_vip: "{{ lookup('env', 'OSP_EXTERNAL_NETWORK_VIP')|default('172.21.0.2', true) }}"

# Network Settings specific to Network setup 0 (private external)
undercloud_public_interface: "{{ lookup('env', 'OSP_UNDERCLOUD_PUBLIC_INTERFACE')|default('eno1', true) }}"
undercloud_external_vlan_device: "{{ lookup('env', 'OSP_UNDERCLOUD_PRIVATE_EXTERNAL_INTERFACE')|default('enp94s0f3', true) }}.{{external_vlan}}"

private_external_address: "{{ lookup('env', 'OSP_PRIVATE_EXTERNAL_ADDRESS')|default('172.21.0.1', true) }}"
private_external_netmask: "{{ lookup('env', 'OSP_PRIVATE_EXTERNAL_NETMASK')|default('255.255.0.0', true) }}"

# Network Settings specific to Network setup 1 (public external)
# None for now


# instackenv:
instackenv_json: "{{ lookup('env', 'INSTACKENV_JSON') }}"

cloud_title: "{{ lookup('env', 'CLOUD_TITLE') }}"
ticket_number: "{{ lookup('env', 'TICKET_NUMBER') }}"
foreman_url: "{{ lookup('env', 'FOREMAN_URL') }}"
undercloud_hostname: "{{ lookup('env', 'UNDERCLOUD_HOSTNAME') }}"

# 47 total systems - 1 undercloud - 5 storage - 3 OpenStack controllers
num_compute: "{{ lookup('env', 'NUM_COMPUTE')|default(37, true) }}"
num_storage: "{{ lookup('env', 'NUM_STORAGE')|default(5, true) }}"

# Must be >= total number of hosts used for undercloud tuning
total_hosts: "{{ num_compute | int + num_storage | int }}"

openstack_deployment_hosts:
  - host_type:
      pin: 1029pcompute # as mapped in roles data under HostnameFormatDefault will have -# appended to lock hosts to machines
      title: P1029Compute # The actual title we use to deploy the role, the name field in roles data
      hint: "1029p" # The hint we look for in the management address string to determine what type of host we're looking at
      count: "{{ num_compute }}" # number of 1029p hosts
  - host_type: #1029u's in the current template
      pin: cephstorage
      title: CephStorage
      hint: "1029u"
      count: "{{ num_storage }}" # The number of systems to use for storage.

controller_type: 1029p
num_controllers: "{{ lookup('env', 'NUM_CONTROLLERS')|default(3, true) }}"
ceph_host: 1029u

# Get the time server from the NTP_SERVER environment variable.
ntp_server: "{{ lookup('env', 'NTP_SERVER') }}"

# Metadata storage
graphite_host: "{{ lookup('env', 'GRAPHITE') }}"
# Graphite prefix / Cloud name used both with graphite and grafana dashboards
graphite_prefix: "{{ lookup('env', 'CLOUD_NAME') }}"
